--to drop the cards database
DROP DATABASE cards;

--creating sample database
CREATE DATABASE IF NOT EXISTS cards;

--to see the existing databases
SHOW DATABASES;

--to use the database
USE CARDS;

--creating sample table
CREATE TABLE deck_of_cards( COLOR string, SUIT string, PIP string)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

--To get the details of the table
DESCRIBE deck_of_cards; --will give only column names and their types
DESCRIBE FORMATTED deck_of_cards; -- will give complete details of table

--To load data into the created table
LOAD DATA LOCAL INPATH '/home/cloudera/deckofcards.txt' INTO TABLE deck_of_cards;

--for creating external tables, we have to give EXTERNAL keyword and LOCATION clause should be provided and it should be at the end of the table creation statement

--creating sample external table
CREATE EXTERNAL TABLE deck_of_cards_external
(COLOR string, SUIT string, PIP string)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE
LOCATION '/user/cloudera/deckofcards.txt' ;
-------------------------------------------------------------------------------------------------------------------------------------

--create ods and EDW Database for retail_db

CREATE DATABASE IF NOT EXISTS retail_ods;
CREATE DATABASE IF NOT EXISTS retail_edw;

--creating ods tables
use retail_ods;
CREATE TABLE categories(category_id int, category_department_id int, category_name string )
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE customers(
customer_id       int,
customer_fname    string,
customer_lname    string,
customer_email    string,
customer_password string,
customer_street   string,
customer_city     string,
customer_state    string,
customer_zipcode  string 
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE departments(
department_id int,
department_name string
)
ROW FORMAT DELIMITED 
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE orders(
order_id int,
order_date string,
order_customer_id int,
order_status string
)
PARTITIONED BY (order_month string)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE order_items(
order_item_id int,
order_item_order_id int,
order_item_order_date string,
order_item_product_id int,
order_item_quantity smallint,
order_item_subtotal float,
order_item_product_price float
)
PARTITIONED BY (order_month string)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE order_bucket(
order_id int,
order_date string,
order_customer_id int,
order_status string
)
CLUSTERED BY (order_id) INTO 16 BUCKETS
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE order_items_bucket(
order_item_id int,
order_item_order_id int,
order_item_order_date string,
order_item_product_id int,
order_item_quantity smallint,
order_item_subtotal float,
order_item_product_price float
)
CLUSTERED BY (order_item_order_id) INTO 16 BUCKETS
ROW FORMAT DELIMITED
FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE products (
product_id int, 
product_category_id int,
product_name string,
product_description string,
product_price float,
product_image string
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

--creating EDW tables(we are following star dimension model)

use retail_edw;
CREATE TABLE products_dimension (
product_id int,
product_name string,
product_description string,
product_price float,
product_category_name string,
product_department_name string
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;

CREATE TABLE order_fact (
order_item_order_id int,
order_item_order_date string,
order_item_product_id int,
order_item_quantity smallint,
order_item_subtotal float,
order_item_product_price float
)
PARTITIONED BY (product_category_department string)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '|'
STORED AS TEXTFILE;
